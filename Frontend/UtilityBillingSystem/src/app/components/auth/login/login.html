<div class="page-wrapper" @pageTransition>
  <div class="auth-container">
    <div class="brand-section" [class.fade-out]="isRedirecting()">
      <h1 class="system-title">Utility Billing System</h1>
      <p class="catchphrase">Efficient Billing, Seamless Living</p>
    </div>

    <mat-card class="login-card" [class.fade-out]="isRedirecting()">
      <h2>Login</h2>

      <form [formGroup]="loginForm" (ngSubmit)="submit()">
      
      <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
        <mat-label>Email</mat-label>
        <input matInput formControlName="email" placeholder="Enter your email">
      </mat-form-field>
      @if (loginForm.controls.email.touched) {
        @if (loginForm.controls.email.errors?.['required']) {
          <div class="error-message">Email is required</div>
        } @else if (loginForm.controls.email.errors?.['email']) {
          <div class="error-message">Enter a valid email address</div>
        }
      }

      <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
        <mat-label>Password</mat-label>
        <input matInput [type]="hidePassword() ? 'password' : 'text'" formControlName="password" placeholder="Enter your password">
        <button mat-icon-button matSuffix (click)="hidePassword.set(!hidePassword())" [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hidePassword()" type="button">
          <mat-icon>{{hidePassword() ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
      </mat-form-field>
      @if (loginForm.controls.password.touched && loginForm.controls.password.errors?.['required']) {
        <div class="error-message">Password is required</div>
      }

      @if (error()) {
        <p class="error-text">{{ error() }}</p>
      }
      @if (success()) {
        <p class="success-text">{{ success() }}</p>
      }

      <button mat-raised-button color="primary" class="full-width" type="submit" [disabled]="loginForm.invalid || loading()">
        @if (loading()) {
          <mat-spinner diameter="20" color="accent"></mat-spinner>
        } @else {
          Login
        }
      </button>

      <p class="register-link">
        New user? <a routerLink="/register">Register here</a>
      </p>

    </form>
  </mat-card>
  </div>
</div>