<div class="form-container">
  <h3>Record Meter Reading</h3>
  
  @if (isLoading) {
    <div class="loading-overlay">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  }

  <form [formGroup]="readingForm" (ngSubmit)="onSubmit()">
    <div class="form-row">
      <mat-form-field appearance="outline">
        <mat-label>Consumer</mat-label>
        <input matInput formControlName="consumerName">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Utility</mat-label>
        <input matInput formControlName="utilityName">
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline">
        <mat-label>Meter Number</mat-label>
        <input matInput formControlName="meterNumber">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Previous Reading</mat-label>
        <input matInput type="number" formControlName="previousReading">
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline">
        <mat-label>Current Reading</mat-label>
        <input matInput type="number" formControlName="currentReading">
        @if (readingForm.get('currentReading')?.hasError('required')) {
          <mat-error>
            Current reading is required
          </mat-error>
        }
        @if (readingForm.get('currentReading')?.hasError('min')) {
          <mat-error>
            Must be at least {{ previousReading }}
          </mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Reading Date</mat-label>
        <input matInput [matDatepicker]="picker" formControlName="readingDate" [max]="maxDate">
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        @if (readingForm.get('readingDate')?.hasError('required')) {
          <mat-error>
            Reading date is required
          </mat-error>
        }
        @if (readingForm.get('readingDate')?.hasError('matDatepickerMax')) {
          <mat-error>
            Reading date cannot be in the future
          </mat-error>
        }
      </mat-form-field>
    </div>

    <div class="form-actions">
      <button mat-button type="button" (click)="onCancel()">Cancel</button>
      <button mat-raised-button color="primary" type="submit" [disabled]="readingForm.invalid || isLoading">
        Save Reading
      </button>
    </div>
  </form>
</div>
